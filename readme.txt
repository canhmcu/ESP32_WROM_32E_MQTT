* Ý TƯỞNG:
- một thiết bị gồm lcd, esp32_wrom_32e, nút nhấn set, nút nhấn nguồn, led báo nguồn, led báo nhận dữ liệu.
- ý tưởng đặt ra là sử dụng giao thức mqtt để truyền nhận dữ liệu với web server và hiển thị nó lên màn hình lcd
- để kết nối với mqtt thì cần cho thiết bị kết nối wifi, mà kết nối được thì ko thể vào code đổi được, người dùng sẽ được cấp 1 cái web để nhập thông tin sau đó gửi cho con esp32, con này nhận và lưu dữ liệu vào eeprom xong rồi thì lần khởi động sau nó cứ vào đó nó lấy thôi, muốn xóa thì 5s đầu khởi động hãy nhấn giữ nút set, tại sao ko phải là lúc đang dùng thì nhấn set là nó xóa dữ liệu? bởi vì thường người ta ít khi thay đổi thông tin, nên nếu mà đặt kiểu quét nút liên tục khi dùng thì chương trình ko tối ưu, chạy phí. Khi mà có dữ liệu từ mqtt thì đèn nháy, người dùng nhấn nút set để thiết bị gửi thông điệp là đã nhận cho trung tâm biết là à thằng này còn ở đây, còn nhận được thông tin :)). Thiết bị nên có cảnh báo khi mất kết nối wifi hoặc khi ko kết nối được mqtt
* THÔNG TIN LIÊN QUAN
- MQTT đọc ở đây "https://deviot.vn/tutorials/esp32.66047996/giao-thuc-mqtt.56263941"
- sau khi đọc xong nội dung về mqtt ta biết được về mqtt rồi nhé, thiết bị của mình nhận giữ liệu từ mqtt broker, vậy broker ở đâu để khi làm mình còn test các thứ, mình sẽ tạo ra 1 broker ảo trên lap, để tạo ra 1 mqtt broker ảo trên máy tính thì bạn cần cài đặt mosquitto theo hướng dẫn ở đây. LƯU Ý chỉ xem phần cài đặt thôi nhé, đoạn sau là nó hướng dẫn dùng luôn rồi, không cần dùng terminal của mosquitto, mình cài nó mục đích chỉ để tạo cái broker thôi, nó có thêm terminal trên command prompt nhưng mình ko dùng "https://www.youtube.com/watch?v=xLLFrLhegcw&t=1s&pp=ygUaY8OhY2ggY8OgaSDEkeG6t3QgbW9zcXVpdG8%3D"
- ok khi cài xong mosquito thì cài thêm MQTT explorer, đây là phần mềm kiểu client đăng ký vô cái broker của lap của mình ấy, xong rồi mình cũng subcribe topic với publish để nhận và truyền nội dung qua broker, khi mình test chương trình thì trong code mình publish 1 topic A rồi, sau đó ra phần mềm MQTT explorer để subcribe cái topic A xong gửi nội dung xem thiết bị nhận được nội dung chưa, nhận được là thành công rồi. link tải đây nha "http://mqtt-explorer.com/"
- bình thường cái broker do mosquitto tạo ra nó ko có cài tên người dùng và mật khẩu, nhưng còn thực tế với IP tĩnh của trung tâm vì tính bảo mật của máy chủ nên họ có cài tên người dùng và mật khẩu. Vậy làm sao để mình cũng cài tên người dùng và mật khẩu cho broker của laptop mình để còn test chương trình cho chuẩn chỉ thì làm theo đây nha "https://ngocautomation.com/cai-dat-mat-khau-cho-broker-mosquitto/" lưu ý là cái bước cuối khi mà mình lưu file mật khẩu ấy, lap tự mã hóa nội dung file, nhìn 1 đống chữ loằng ngoẳng thì mình cũng kệ nha, để yên đó là xong rồi. Trong chỗ mosquitto.conf có đoạn sửa allow_anonymous thì cho veef false nha, cái này là hỏi xem chấp nhận thằng vô danh ko khai báo user ko ấy.
- cài xong các thứ rồi nha.
- để thực hiện ý tưởng thiết bị tạo ra web cho người dùng nhập thông tin thì cần biết đến web server của esp32 cũng như là các chế độ wifi của nó, xem nội dung các chế độ wifi và các nội dụng esp32 web server nha "https://deviot.vn/tutorials/esp32.66047996/cac-che-do-wi-fi.27735609" .
- xem xong rồi thì mình tổng hợp lại là lần dùng đầu tiên, khi chưa có dữ liệu gì trong eeprom thì nó ở chế độ AP để người dùng bắt wifi rồi truy cập web và nhập thông tin cho thiết bị kết nối cũng như lưu luôn vào eeprom, lần sau sử dụng lại, kiểu bật nguồn lại thì eeprom có dữ liệu rồi, tự bắt wifi và về chế độ SA mode rồi dùng để nhận thông tin từ broker thôi
- để biết về eeprom thì xem qua video này "https://www.youtube.com/watch?v=YpkMi9f3Y_U&t=460s"
- để code thì cần biết con vdk mình dùng nó có thông số, chức năng đặc biệt gì, nạp code thế nào, mua ở đâu, mọi thứ đều nằm ở link này nha
"https://wiki.makerlab.vn/index.php/M%E1%BA%A1ch_Mtiny_ESP32_WROOM-32E_(Arduino_Compatible)", màn hình lcd thì đây "https://hshop.vn/products/lcd-graphic-12864-xanh-lo"
* TIẾN HÀNH CODE THÔI
- đầu tiên code thì tải mấy thư viện về đã nha, thư viện thì mình ghi đầu code rồi
- để điều khiển lcd thì xem đây nha "https://www.youtube.com/watch?v=aACOC9XBBks&t=314s", con lcd có trở R9, CẦN THÁO NÓ RA ĐỂ ĐK SPI NHA
- sơ đồ chân thì tôi để trong ảnh của project nha
- tôi chia mảng bộ nhớ eeprom gồm 512byte ra các mảng nhỏ, mỗi mảng 64byte để lưu dữ liệu lần lượt là tên wf, mật khẩu wf, ip, port, id, user, pass mqtt.
- code thì có các phần khởi tạo, khi vào khởi tạo chờ 5s để xem bấm nút ko(chú ý nút nhấn có lệnh button.loop()), sau đó bắt đầu kiểm tra eeprom trong hàm firstconnect, nếu không có dữ liệu thì thực hiện hàm accesspoint còn có dữ liệu thì thực hiện hàm stationmode, hàm accesspoint tạo web server với lại lưu dữ liệu vào eeprom xong rồi kết nối mqtt, hàm stationmode thì kết nối wifi và mqtt luôn, sau đó thì về hàm loop, trong loop thì luôn đọc trạng thái các cờ tôi thiết lập để hiển thị lcd, ví dụ khi tôi ở chế độ accesspoint thì tôi cho cờ statussy(status system) bằng 0, vào loop nó quét bằng 0 thì lcd hiển thị nội dung trong các hàm hiển thị nội dung của lcd.
- các hàm read, write, cleEE(hàm xóa dữ liệu) cuẩ EEPROM cũng phải tự viết.
- trong hàm accesspoint có truy cập đến handleRoot và handleConnect, 2 hàm này 1 hàm là viết cho web để nhập dữ liệu, hàm root được gọi khi server nhận được yêu cầu bật, còn 1 hàm được gọi khi người dùng nhấn nút submit trên web để hiện thị nội dung báo kết nối ok chưa.Bên cạnh đó nếu web lỗi thì truy cập hàm handleNotFound. 
- Mqtt thì có hàm callback, hàm này để biết là khi có dữ liệu từ mqtt gửi đến thì mình làm gì, ở đây tôi chỉ lấy dữ liệu nhận được và đưa vào mảng để tí nữa hiển thị ra lcd
- cuối cùng là các hàm viết cho lcd thôi.
- 2 topic là outTopic và inTopic nha.
- với kết nối MQTT thì đầu tiên dùng hàm client.setServer(STServerOrIP.c_str(), STPort.toInt());
  client.setCallback(callback); để tìm đến IP mqtt đã, bình thường có hàm setServer là nó kết nối đc mqtt rồi nhưng mosquitto ko chấp nhận vô danh(ko biết user) nên nó chưa kết nối đc, đến khi vào while của reconnect để nó kiểm tra user với pass cũng như thiết lập Topic thì lúc này kết nối mqtt mới biết là ok hay không, nếu có lỗi thì màn hình báo lỗi và hiện ra thông tin mình nhập trong 7s để mình check, rồi nó mất đi 7s sau nó lại hiện.
- port của mqtt là để thể hiện mã hóa thông tin hay ko, 1883 là ko mã hóa còn 8883 là mã hóa, ngoài ra còn 1 vài port nữa nhưng mình dùng port 1883.